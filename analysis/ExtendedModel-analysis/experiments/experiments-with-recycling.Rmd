---
title: "experiments-with-recycling"
author: "Emily Coco"
date: "9/24/2021"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

library(tidyverse)
library(naniar)
library(rpart)
library(rpart.plot)
library(data.table)
theme_set(theme_minimal())

parameters = c("max_use_intensity", "max_artifact_carry", "max_flake_size","max_nodules_size", "blank_prob", "scavenge_prob", "overlap","mu", "size_preference", "flake_preference","min_suitable_flake_size", "strict_selection")

# alldata = read_csv("/Users/emilycoco/eclipse-workspace/recycling-Java/output/sub_small.csv")
# alldata = as.data.frame(fread("/Users/emilycoco/eclipse-workspace/recycling-Java/output/sub_small.csv", select=c(parameters, "model_year", "total.RI")))
# alldata = alldata %>% mutate(
#   total.RI = as.numeric(total.RI),
#   total.CR = as.numeric(total.CR)
# )
# 
# alldata = alldata[1:50010,]
# 
# parameters = colnames(alldata[,c(1,4:9,11:17)])


for(p in parameters) {
  print(c(unique(alldata[p])))
}

```

## Where is there missing data for recycling intensity?
Because of the way that recycling intensity is calculated

```{r missing-recycling-intensity}

visdat::vis_dat(alldata, warn_large_data = F)

for(p in parameters) {
  graph_data = alldata %>% select(model_year, p, total.RI)
  
  ggplot(graph_data, aes(x = model_year, y = total.RI)) +
    geom_miss_point() +
    facet_wrap(as.formula(paste("~", p)), labeller=label_both) +
    scale_x_reverse()
  
}

alldata %>%
  select(parameters, "total.RI") %>%
  add_prop_miss() %>%
  rpart(prop_miss_all ~ ., data = ., model=T) %>%
  prp(type = 4, extra = 101, prefix = "Prop. Miss =")

```


