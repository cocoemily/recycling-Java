---
title: "experiments-with-recycling"
author: "Emily Coco"
date: "9/24/2021"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

library(tidyverse)
library(naniar)
library(rpart)
library(rpart.plot)
library(data.table)
library(UpSetR)
theme_set(theme_minimal())

parameters = c("max_use_intensity", "max_artifact_carry", "max_flake_size","max_nodules_size", "blank_prob", "scavenge_prob", "overlap","mu", "size_preference", "flake_preference","min_suitable_flake_size", "min_suitable_nodule_size", "strict_selection")

alldata = read_csv("/Users/emilycoco/eclipse-workspace/recycling-Java/output/joined_model_data.csv")
# alldata = as.data.frame(fread("/Users/emilycoco/eclipse-workspace/recycling-Java/output/sub_small.csv"))
# alldata = alldata %>% mutate(
#   total.RI = as.numeric(total.RI),
#   total.CR = as.numeric(total.CR)
# )
# 
# alldata = alldata[1:50010,]
# 
# parameters = colnames(alldata[,c(1,4:9,11:17)])

outputs = c("num.scav.events","total.recycled", "num.deposits",	"total.encounters",	"total.discards",	"total.manu.events", "total.retouches", "total.CR",	"total.RI")

```

## Where is there missing data for recycling intensity?
Because of the way that recycling intensity is calculated

```{r missing-recycling-intensity}
output_data = alldata %>% select(outputs)
gg_miss_var(output_data, show_pct = T)


missing_counts = alldata %>% group_by_at(parameters) %>%
  summarize(missing.RI = sum(is.na(total.RI))/n(), 
            missing.CR = sum(is.na(total.CR))/n(), 
            total.discards = sum(total.discards))

lmdata = missing_counts %>% select(parameters, "missing.RI")
m1 = lm(missing.RI ~ . , data = lmdata)
summary(m1)
plot(m1, which=2)

m2 = lm(missing.RI ~ max_flake_size*max_nodules_size*size_preference*flake_preference*min_suitable_flake_size, data = lmdata)
stargazer::stargazer(m2, type= "text")



```


