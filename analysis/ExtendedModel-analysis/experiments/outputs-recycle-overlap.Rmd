---
title: "recycling-correlations"
author: "Emily Coco"
date: "9/28/2021"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

library(tidyverse)
library(data.table)
library(rcompanion)

theme_set(theme_minimal())

source("layers-data-prep.R")

layerdata = df

parameters = c("max_use_intensity", "max_artifact_carry", "max_flake_size","max_nodules_size", "blank_prob", "scavenge_prob", "overlap","mu", "size_preference", "flake_preference","min_suitable_flake_size", "strict_selection")
outputs = c("ri.cr.cor","ri.nc.cor","ri.fc.cor","ri.nd.cor","ri.ns.cor","ri.ne.cor","ri.nm.cor","ri.nr.cor","ri.no.cor","ri.av.cor")

```

## Do high values of recycling correspond with certain values of the other behaviors?
```{r cor-hist, warning = F}

plotNormalHistogram(df$ri.cr.cor)
plotNormalHistogram(df$ri.nc.cor)
plotNormalHistogram(df$ri.fc.cor)
plotNormalHistogram(df$ri.nd.cor)
plotNormalHistogram(df$ri.ns.cor) 
plotNormalHistogram(df$ri.ne.cor)
plotNormalHistogram(df$ri.nm.cor)
plotNormalHistogram(df$ri.nr.cor)
plotNormalHistogram(df$ri.no.cor)
plotNormalHistogram(df$ri.av.cor)


             
```


## How are the relationships between recycling intensity and other behaviors impacted by experimental parameters?
```{r relationships, warning=F, fig.dim=c(11, 5)}

plot_correlations = function(o) {
  p1 = ggplot(layerdata, aes(x = as.factor(blank_prob), y = get(o), color = as.factor(scavenge_prob))) +
  geom_boxplot() +
  facet_grid(max_use_intensity ~ max_artifact_carry, labeller = label_both) +
    labs(x = "blank prob", y = o, color = "scavenge prob") +
    theme(text = element_text(size = 6))
  
  p2 = ggplot(layerdata, aes(x = as.factor(max_flake_size), y = get(o), color = as.factor(max_nodules_size))) +
  geom_boxplot() +
  facet_grid(min_suitable_flake_size ~ size_preference + flake_preference + strict_selection, labeller = label_both) +
    labs(x = "max flake size", y = o, color = "max nod size") +
    theme(text = element_text(size = 6))
  
  p3 = ggplot(layerdata, aes(x = as.factor(blank_prob), y = get(o), color = as.factor(scavenge_prob))) +
  geom_boxplot() +
  facet_grid(overlap ~ mu, labeller = label_both) +
    labs(x = "blank prob", y = o, color = "scavenge prob") +
    theme(text = element_text(size = 6))
  
  return(list(p1, p3, p2))
}

for(o in outputs) {

  plots = plot_correlations(o)
  plot(cowplot::plot_grid(plots[[1]], plots[[2]], plots[[3]]))

  
}



```


## Linear regressions of all parameters on correlations between recycling intensity and other variables
Currently missing min suitable nodule size because original sensitivity analysis   

```{r cor-regs, warning=F, }

#regression of recycling intensity and cortex ratio correlation
model1 = lm(ri.cr.cor ~ max_use_intensity + max_artifact_carry + max_flake_size + max_nodules_size + blank_prob + scavenge_prob + overlap + mu + size_preference + flake_preference + min_suitable_flake_size + strict_selection, data = layerdata)
qqnorm(model1)
summary(model1)

#regression of recycling intensity and assemblage volume
model10 = lm(ri.av.cor ~ max_use_intensity + max_artifact_carry + max_flake_size + max_nodules_size + blank_prob + scavenge_prob + overlap + mu + size_preference + flake_preference + min_suitable_flake_size + strict_selection, data = layerdata)
qqnorm(model10)
summary(model10)

#regression of recycling intensity and flake count correlation
model2 = lm(ri.fc.cor ~ max_use_intensity + max_artifact_carry + max_flake_size + max_nodules_size + blank_prob + scavenge_prob + overlap + mu + size_preference + flake_preference + min_suitable_flake_size + strict_selection, data = layerdata)
qqnorm(model2)
summary(model2)

#regression of recycling intensity and nodule count correlation
model3 = lm(ri.nc.cor ~ max_use_intensity + max_artifact_carry + max_flake_size + max_nodules_size + blank_prob + scavenge_prob + overlap + mu + size_preference + flake_preference + min_suitable_flake_size + strict_selection, data = layerdata)
qqnorm(model3)
summary(model3)

#regression of recycling intensity and number of discards
model4 = lm(ri.nd.cor ~ max_use_intensity + max_artifact_carry + max_flake_size + max_nodules_size + blank_prob + scavenge_prob + overlap + mu + size_preference + flake_preference + min_suitable_flake_size + strict_selection, data = layerdata)
qqnorm(model4)
summary(model4)

#regression of recycling intensity and number of scavenging events
model5 = lm(ri.ns.cor ~ max_use_intensity + max_artifact_carry + max_flake_size + max_nodules_size + blank_prob + scavenge_prob + overlap + mu + size_preference + flake_preference + min_suitable_flake_size + strict_selection, data = layerdata)
qqnorm(model5)
summary(model5)

#regression of recycling intensity and number of encounters
model6 = lm(ri.ne.cor ~ max_use_intensity + max_artifact_carry + max_flake_size + max_nodules_size + blank_prob + scavenge_prob + overlap + mu + size_preference + flake_preference + min_suitable_flake_size + strict_selection, data = layerdata)
qqnorm(model6)
summary(model6)

#regression of recycling intensity and number of manufacture events
model7 = lm(ri.nm.cor ~ max_use_intensity + max_artifact_carry + max_flake_size + max_nodules_size + blank_prob + scavenge_prob + overlap + mu + size_preference + flake_preference + min_suitable_flake_size + strict_selection, data = layerdata)
qqnorm(model7)
summary(model7)

#regression of recycling intensity and number of retouch events
model8 = lm(ri.nr.cor ~ max_use_intensity + max_artifact_carry + max_flake_size + max_nodules_size + blank_prob + scavenge_prob + overlap + mu + size_preference + flake_preference + min_suitable_flake_size + strict_selection, data = layerdata)
qqnorm(model8)
summary(model8)

#regression of recycling intensity and number of occupations
model9 = lm(ri.no.cor ~ max_use_intensity + max_artifact_carry + max_flake_size + max_nodules_size + blank_prob + scavenge_prob + overlap + mu + size_preference + flake_preference + min_suitable_flake_size + strict_selection, data = layerdata)
qqnorm(model9)
summary(model9)


```


