---
title: "sensitivity-regressions"
author: "Emily Coco"
date: "10/12/2021"
output: html_document
editor_options: 
  chunk_output_type: inline
---

```{r setup, include=F}
knitr::opts_chunk$set(echo = TRUE)
knitr::opts_knit$set(verbose = TRUE)


library(tidyverse)
library(ggpubr)
library(moments)
library(emmeans)
library(multcomp)
library(rcompanion)
library(forecast)
library(gamlss)
library(pscl)
library(MASS)
library(glmmTMB)
library(rstatix)
library(bbmle)
library(fitdistrplus)
library(lmtest)
library(betareg)
library(sandwich)
library(foreign)
library(car)
library(gplots)

theme_set(theme_minimal())

# alldata = read_csv("../output/sub_sens-data.csv")

alldata = alldata %>% filter(size != "size") %>%
  mutate(total.RI = as.numeric(total.RI), 
         total.CR = as.numeric(total.CR)) %>%
  group_by(max_use_intensity, max_artifact_carry, max_flake_size, max_nodules_size, blank_prob, scavenge_prob, overlap, mu, size_preference, flake_preference, min_suitable_flake_size, min_suitable_nodule_size, strict_selection) %>%
  mutate(exp = cur_group_id()) %>%
  filter(!is.na(total.RI))

parameters = c("max_use_intensity", "max_artifact_carry", "max_flake_size",
               "max_nodules_size", "blank_prob", "scavenge_prob", "overlap",
               "mu", "size_preference", "flake_preference",
               "min_suitable_flake_size", "min_suitable_nodule_size",
               "strict_selection")


```


### Testing closest interaction lines via regression analysis
In the interaction plots, flake preference and minimum suitable nodule size had very similar lines, suggesting that these variables may not be significantly affecting the amount of recycled objects over time. 

```{r distributions, eval=T, message=F}

plotNormalHistogram(alldata$total.RI)

#descdist(alldata$total.RI, discrete=T, boot=100)
#descdist(alldata$total.RI, discrete=F, boot=100)

round(cor(alldata[,c(parameters, "total.RI")]), 2)

```

```{r regressions, eval=T, message=F}

u_alldata = alldata %>% mutate(s.total.RI = ifelse(total.RI == 0, (total.RI + 0.0001), total.RI)) %>% mutate(s.total.RI = ifelse(s.total.RI == 1, (s.total.RI - 0.0001), s.total.RI))


#beta regression analysis
breg1 = betareg(s.total.RI ~ model_year + max_use_intensity  + max_artifact_carry + max_flake_size + max_nodules_size + blank_prob + scavenge_prob + overlap + mu + size_preference + flake_preference + min_suitable_flake_size + min_suitable_nodule_size + strict_selection , data=u_alldata)

# breg2 = betareg(s.total.RI ~ model_year + max_use_intensity + max_artifact_carry + max_flake_size + max_nodules_size + blank_prob + scavenge_prob + overlap + mu + size_preference + flake_preference + min_suitable_flake_size + strict_selection , data=u_alldata)
# 
# breg3 = betareg(s.total.RI ~ model_year + max_use_intensity + max_artifact_carry + max_flake_size + max_nodules_size + blank_prob + scavenge_prob + overlap + mu + size_preference + min_suitable_flake_size + strict_selection , data=u_alldata)
# 
# lrtest(breg3, breg2, breg1)


plot(breg1$fitted.values, breg1$residuals)
bptest(breg1)

coeftest(breg1, vcov = vcovBS(breg1, R=50))

```

